# Інструкція для Release Engineer / DevOps: Розгортання Проєкту "ShelterApp" у Production Середовищі (Windows 11)

Цей документ надає покрокові інструкції для розгортання веб-додатку "ShelterApp" у виробничому середовищі на базі операційної системи Windows 11.

---

**1. Загальні Припущення та Компоненти:**

* **Операційна система:** Windows 11.
* **Сервер додатку:** Flask (Python).
* **WSGI-сервер:** Waitress (для запуску Flask-додатку).
* **База даних:** SQLite (`shelter.db`).
* **Веб-сервер (Reverse Proxy):** Не використовується на цьому етапі для спрощення. Додаток буде доступний безпосередньо через Waitress. Для великомасштабних розгортань рекомендується інтеграція з IIS або Nginx.
* **Код проекту:** Буде клонований з Git-репозиторію.

**2. Вимоги до Апаратного Забезпечення:**

* **Архітектура CPU:** x86-64 (будь-який сучасний процесор Intel/AMD).
* **Мінімальний CPU:** 2 ядра.
* **Мінімальна Оперативна Пам'ять:** 2 GB (для додатку та ОС).
* **Мінімальний Диск:** 5 GB вільного місця (для ОС, Python, коду додатку та бази даних).
* **Мережа:** Стабільне підключення до Інтернету для завантаження залежностей та доступ до локальної мережі або публічного інтернету для користувачів.

**3. Необхідне Програмне Забезпечення:**

* **Операційна система:** Windows 11 (встановлена та оновлена).
* **Python:** Python 3.10 або новіша версія (рекомендується встановити останню стабільну версію з офіційного сайту python.org). Переконайтеся, що Python додано до змінних середовища PATH під час встановлення.
* **Git:** Встановлений для клонування репозиторію.
* **Visual C++ Redistributable:** Може знадобитися для деяких Python-пакетів. Зазвичай, встановлюється автоматично з Python, але варто перевірити.

**4. Налаштування Мережі (Фаєрвол):**

* **Дозволити вхідні підключення:** Переконайтеся, що фаєрвол Windows дозволяє вхідні підключення до порту, на якому буде працювати ваш додаток (за замовчуванням 5000, або інший, який ви оберете).
    * **Дії:** Відкрийте "Брандмауер Захисника Windows з розширеними функціями" (Windows Defender Firewall with Advanced Security) -> "Правила для вхідних підключень" (Inbound Rules) -> "Створити правило" (New Rule...). Оберіть "Порт" (Port), вкажіть TCP-порт 5000 (або інший), дозвольте підключення.

**5. Розгортання Коду Проєкту:**

1.  **Створіть директорію для проєкту:**
    Наприклад, створіть папку `C:\ShelterApp`.
    ```powershell
    mkdir C:\ShelterApp
    cd C:\ShelterApp
    ```

2.  **Клонуйте репозиторій проекту:**
    ```powershell
    git clone [https://github.com/your-username/your-repo-name.git](https://github.com/your-username/your-repo-name.git) . # Замініть на реальний URL репозиторію вашого проекту
    ```
    *Примітка:* `.` в кінці команди клонує вміст репозиторію безпосередньо в поточну папку `C:\ShelterApp`.

3.  **Створіть та активуйте віртуальне середовище:**
    ```powershell
    python -m venv .venv
    .\.venv\Scripts\activate
    ```
    Ви повинні побачити `(.venv)` на початку командного рядка, що вказує на активацію віртуального середовища.

4.  **Створіть файл `requirements.txt`:**
    На **машині розробки** (де у вас вже встановлені всі залежності, наприклад, у проєкті PyCharm), з активованим віртуальним середовищем, виконайте:
    ```powershell
    pip freeze > requirements.txt
    ```
    Потім **скопіюйте цей `requirements.txt`** до папки `C:\ShelterApp` на production-сервері.

5.  **Встановіть залежності проєкту:**
    Переконайтеся, що ви знаходитесь у папці `C:\ShelterApp` і віртуальне середовище активоване.
    ```powershell
    pip install -r requirements.txt
    pip install waitress # Waitress може не бути в requirements.txt, встановіть окремо
    ```

6.  **Налаштуйте змінні середовища:**
    Для production-середовища важливо встановити Flask `SECRET_KEY` як системну змінну для безпеки.
    * **Постійно (рекомендовано):** Відкрийте "Панель керування" -> "Система" -> "Додаткові параметри системи" -> "Змінні середовища". У розділі "Системні змінні" (System variables) натисніть "Створити" (New...) і додайте:
        * **Ім'я змінної:** `FLASK_SECRET_KEY`
        * **Значення змінної:** `a_very_secret_key_for_diploma_project` (Використовуйте **СВІЙ УНІКАЛЬНИЙ** секретний ключ!)
    * *Примітка:* Ваш код зараз використовує `app.config['SECRET_KEY']`. Для використання системної змінної, ви можете змінити відповідний рядок в `app.py` на `app.config['SECRET_KEY'] = os.environ.get('FLASK_SECRET_KEY')`.

**6. Налаштування Бази Даних (SQLite):**

1.  **Розміщення `shelter.db`:**
    Файл `shelter.db` має знаходитися в корені вашого проєкту (`C:\ShelterApp\shelter.db`).

2.  **Ініціалізація або міграція бази даних:**
    Якщо файл `shelter.db` ще не існує або його потрібно ініціалізувати, запустіть ваш скрипт `init_db.py`.
    Переконайтеся, що ви знаходитесь у `C:\ShelterApp` і віртуальне середовище активоване.
    ```powershell
    python init_db.py
    ```
    *Примітка:* Переконайтеся, що ваш `init_db.py` безпечний для повторного запуску без втрати даних, або запускайте його лише один раз під час первинного розгортання на чистому середовищі.

**7. Розгортання та Запуск Коду (Waitress):**

1.  **Створіть скрипт для запуску додатку (наприклад, `run_app.bat`):**
    У папці `C:\ShelterApp` створіть новий текстовий файл з іменем `run_app.bat` і додайте в нього наступний вміст:
    ```batch
    @echo off
    REM run_app.bat

    REM Переходимо до папки проекту
    cd /d "%~dp0"

    REM Активуємо віртуальне середовище
    call .\.venv\Scripts\activate.bat

    REM Встановлюємо FLASK_APP для Flask
    set FLASK_APP=app

    REM Запускаємо Flask-додаток за допомогою Waitress
    REM Host 0.0.0.0 дозволяє доступ з будь-якого IP
    REM Port 5000 - стандартний порт Flask
    python -m waitress --host=0.0.0.0 --port=5000 app:app
    ```
    *Пояснення:* `app:app` вказує Waitress, що потрібно запустити об'єкт `app` з модуля `app.py`.

2.  **Запустіть додаток:**
    Ви можете запустити додаток вручну, двічі клацнувши на `run_app.bat`, або через командний рядок:
    ```powershell
    C:\ShelterApp\run_app.bat
    ```
    Додаток почне працювати і буде доступний за адресою `http://<IP_адреса_сервера>:5000/`.

**8. Забезпечення Безперервної Роботи (Базово):**

Для того, щоб додаток запускався автоматично при старті сервера та працював у фоновому режимі, можна використати Планувальник завдань Windows (Windows Task Scheduler).

1.  **Відкрийте "Планувальник завдань" (Task Scheduler):**
    Натисніть `Win + R`, введіть `taskschd.msc` і натисніть Enter.

2.  **Створіть нове завдання (Create Basic Task...):**
    * **Ім'я:** `Run ShelterApp Flask`
    * **Опис:** `Запускає веб-додаток ShelterApp у фоновому режимі.`
    * **Тригер (Trigger):** `При запуску комп'ютера` (When the computer starts).
    * **Дія (Action):** `Запустити програму` (Start a program).
        * **Програма/скрипт (Program/script):** `C:\Windows\System32\cmd.exe`
        * **Додати аргументи (Add arguments (optional)):** `/c "C:\ShelterApp\run_app.bat"` (це запустить ваш бат-файл)
        * **Почати в (Start in (optional)):** `C:\ShelterApp`

3.  **Налаштуйте розширені параметри (після створення базового завдання):**
    * Відкрийте властивості щойно створеного завдання (подвійний клік на ньому).
    * На вкладці `Загальні` (General) встановіть:
        * `Запускати, незалежно від входу користувача` (Run whether user is logged on or not)
        * `Запускати з найвищими привілеями` (Run with highest privileges)
    * На вкладці `Параметри` (Settings) перевірте, щоб завдання повторно запускалося, якщо воно зупинилося.

**9. Перевірка Працездатності:**

1.  **Доступ до додатку:**
    Відкрийте веб-браузер на іншому комп'ютері в мережі (або на самому сервері) та перейдіть за адресою: `http://<IP_адреса_сервера>:5000/`
    Ви повинні побачити головну сторінку додатку "ShelterApp".

2.  **Перевірка функціоналу:**
    * Спробуйте зареєструватися (якщо БД порожня).
    * Увійдіть в систему.
    * Спробуйте додати нову тварину.
    * Перевірте роботу пагінації та фільтрів.

3.  **Перевірка логів:**
    Якщо додаток запущено через `run_app.bat` у консолі, стежте за виводом. Для постійної роботи через Планувальник завдань, вам може знадобитися налаштувати Flask-логер для запису в файл.